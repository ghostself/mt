<html>
    <head>
        <script>
            // TODO: use zepto lib function instead
            function getUrlParam(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
                var r = window.location.search.substr(1).match(reg);  //匹配目标参数
                if (r != null) return unescape(r[2]); return null; //返回参数值
            }
        
            // TODO: load version data from a static file
            var latestVersion = '1.0';
            var latestBuild = '2';
            
            // check version
            var downloadUrl = 'itms-services://?action=download-manifest&url=https://ghostself.github.io/mt/meituanchaoshi.plist';
            
            var version = Number(getUrlParam('version'));
            var build = Number(getUrlParam('build'));
            
            if(version * 10000 + build < latestVersion * 10000 + latestBuild) {
                // need update
                alert('检测到新版本，当前版本为version ' + version + ' build ' + build);
                window.location.href = updateUrl;
            } else {
                // redirect to landing page
                window.location.href = 'http://i.waimai.meituan.com';
            }
            
                </script>
    </head>
    <body>
        <h1>download</h1>
        <p>
        <a href='itms-services://?action=download-manifest&url=https://ghostself.github.io/mt/meituanchaoshi.plist'>update</a>
        </p>
        <p>
        <a href='http://i.waimai.meituan.com'>GO</a>
        </p>
    </body>
</html>
