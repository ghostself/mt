<html>
    <head>
        <script>
            // TODO: use zepto lib function instead
            function getUrlParam(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
                var r = window.location.search.substr(1).match(reg);  //匹配目标参数
                if (r != null) return unescape(r[2]); return null; //返回参数值
            }
        
            function versionAsNumber(version) {
                var a = version.split('.');
                var n = 0;
                for (var i = 0; i < a.length; i++) {
                    n = n * 100 + Number(a[i]);
                }
                return n;
            }
        
            // TODO: load version data from a static file, with type of Number
            var latestVersion = '1.0.3';
            
            // check version
            var downloadUrl = 'http://ghostself.github.io/mt';//'itms-services://?action=download-manifest&url=https://ghostself.github.io/mt/meituanchaoshi.plist';
            
            var version = getUrlParam('version');
            var from = getUrlParam('f');
            
            if(versionAsNumber(version) < versionAsNumber(latestVersion)) {
                // need update
                // TODO: use YES/NO dialog instead
                alert('检测到新版本，当前版本为version ' + version + ' build ' + build);
                window.location.href = downloadUrl;
                // TODO: post-update interactions
                
            } else {
                // redirect to landing page
                // TODO: use chaoshi.meituan.com instead
                window.location.href = 'http://i.waimai.meituan.com';
            }
            
                </script>
    </head>
    <body>
        <p>
        <a href='http://i.waimai.meituan.com'>继续访问</a>
        </p>
    </body>
</html>
